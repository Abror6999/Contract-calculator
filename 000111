<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Калькулятор контракта</title>
<style>
body {
  font-family: Arial, sans-serif;
  min-height: 100vh;
  margin: 0;
  padding: 20px;
  background: linear-gradient(135deg, #667eea, #764ba2);
}
.container {
  max-width: 560px;
  background: #ffffff;
  padding: 22px;
  border-radius: 16px;
  margin: auto;
  box-shadow: 0 15px 40px rgba(0,0,0,0.15);
}
.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.lang-switch button {
  padding: 6px 10px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin-left: 5px;
  font-weight: bold;
}
.lang-switch button.active {
  background: #667eea;
  color: white;
}
h2 {
  text-align: center;
  margin: 15px 0;
}
label {
  font-weight: bold;
  margin-top: 12px;
  display: block;
}
select, input {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 15px;
}
.result {
  margin-top: 20px;
  padding: 15px;
  border-radius: 10px;
  background: #f3f6f9;
}
.ok {
  color: #1a7f37;
  font-weight: bold;
}
.late {
  color: #c0392b;
  font-weight: bold;
}
</style>
</head>
<body>
<div class="container">
<div class="top-bar">
  <div></div>
  <div class="lang-switch">
    <button id="ruBtn" class="active" onclick="setLang('ru')">RU</button>
    <button id="uzBtn" onclick="setLang('uz')">UZ</button>
  </div>
</div>
<h2 id="title">Калькулятор оплаты контракта</h2>
<label id="lblDate">Дата расчёта</label>
<input type="date" id="calcDate" onchange="update()">
<label id="lblType">Тип студента</label>
<select id="type" onchange="updateContractOptions(); update();">
  <option value=""></option>
  <option value="normal"></option>
  <option value="stipend"></option>
  <option value="foreign_vnj"></option>
  <option value="foreign_visa"></option>
</select>
<label id="lblCourse">Курс</label>
<select id="course" onchange="updateContractOptions(); update();">
  <option value=""></option>
  <option value="1"></option>
  <option value="2"></option>
  <option value="3"></option>
  <option value="4"></option>
</select>
<label id="lblContract">Тип контракта</label>
<select id="contract" onchange="update();">
  <option value="base"></option>
  <option value="super"></option>
</select>
<label id="lblPaid">Уже оплачено (сум)</label>
<input type="text" id="paid" placeholder="0">
<div class="result" id="output"></div>
</div>
<script>
let lang = "ru";
const text = {
  ru: {
    title: "Калькулятор оплаты контракта",
    date: "Дата расчёта",
    type: "Тип студента",
    course: "Курс",
    contract: "Тип контракта",
    paid: "Уже оплачено (сум)",
    normal: "Обычный",
    stipend: "Со стипендией",
    vnj: "Иностранец (ВНЖ)",
    visa: "Иностранец (Виза)",
    base: "Базовый",
    super: "Суперконтракт",
    statusOk: "Оплата в норме",
    statusLate: "Просрочка: должно быть"
  },
  uz: {
    title: "Kontrakt to‘lovi kalkulyatori",
    date: "Hisoblash sanasi",
    type: "Talaba turi",
    course: "Kurs",
    contract: "Shartnoma turi",
    paid: "To‘langan summa (so‘m)",
    normal: "Oddiy",
    stipend: "Stipendiyali",
    vnj: "Chet ellik (VNH)",
    visa: "Chet ellik (Viza)",
    base: "Asosiy",
    super: "Super-kontrakt",
    statusOk: "To‘lov me’yorida",
    statusLate: "Kechikish: talab qilinadi"
  }
};
const normalPrices = {
  1: { base: 33750000, super: 146250000 },
  2: { base: 33750000 },
  3: { base: 27301000 },
  4: { base: 27301000 }
};
const stipendPrices = {
  1: { base: 40586020, super: 153086020 },
  2: { base: 40586020 },
  3: { base: 34137020 },
  4: { base: 34137020 }
};
const foreignPrices = {
  foreign_vnj: 38400000,
  foreign_visa: 44800000
};
function setLang(l) {
  lang = l;
  document.getElementById("ruBtn").classList.toggle("active", l === "ru");
  document.getElementById("uzBtn").classList.toggle("active", l === "uz");
  applyText();
  update();
}
function applyText() {
  const t = text[lang];
  document.getElementById("title").innerText = t.title;
  document.getElementById("lblDate").innerText = t.date;
  document.getElementById("lblType").innerText = t.type;
  document.getElementById("lblCourse").innerText = t.course;
  document.getElementById("lblContract").innerText = t.contract;
  document.getElementById("lblPaid").innerText = t.paid;
  const typeOpts = document.getElementById("type").options;
  typeOpts[1].text = t.normal;
  typeOpts[2].text = t.stipend;
  typeOpts[3].text = t.vnj;
  typeOpts[4].text = t.visa;
  const courseOpts = document.getElementById("course").options;
  const courseTexts = lang === 'ru' ? ["", "1 курс", "2 курс", "3 курс", "4 курс"] : ["", "1-kurs", "2-kurs", "3-kurs", "4-kurs"];
  for (let i = 0; i < courseOpts.length; i++) {
    courseOpts[i].text = courseTexts[i];
  }
  const contractOpts = document.getElementById("contract").options;
  contractOpts[0].text = t.base;
  contractOpts[1].text = t.super;
}
function formatNumber(num) {
  return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}
document.addEventListener("DOMContentLoaded", function() {
  applyText();
  const today = new Date();
  const currentMonth = today.getMonth();
  const currentYear = today.getFullYear();
  const acadStartYear = currentMonth >= 8 ? currentYear : currentYear - 1;
  document.getElementById("calcDate").min = `${acadStartYear}-09-01`;
  document.getElementById("calcDate").max = `${acadStartYear + 1}-08-31`;
  const paidInput = document.getElementById("paid");
  paidInput.addEventListener('input', function() {
    let val = this.value.replace(/\D/g, '');
    this.value = formatNumber(val);
    update();
  });
});
function updateContractOptions() {
  const type = document.getElementById("type").value;
  const course = document.getElementById("course").value;
  const contract = document.getElementById("contract");
  const superOption = contract.querySelector('option[value="super"]');
  const allowSuper = course === "1" && (type === "normal" || type === "stipend");
  superOption.style.display = allowSuper ? "block" : "none";
  if (!allowSuper && contract.value === "super") contract.value = "base";
}
function update() {
  const dateVal = document.getElementById("calcDate").value;
  const type = document.getElementById("type").value;
  const course = document.getElementById("course").value;
  const contractType = document.getElementById("contract").value;
  const paidInput = document.getElementById("paid");
  const rawPaid = paidInput.value.replace(/\./g, '');
  const paid = Number(rawPaid) || 0;
  const output = document.getElementById("output");
  if (!dateVal || !type || !course) {
    output.innerHTML = '';
    return;
  }
  let total = 0;
  if (type.startsWith('foreign_')) {
    total = foreignPrices[type];
  } else {
    const prices = type === 'normal' ? normalPrices : stipendPrices;
    if (prices[course] && prices[course][contractType] !== undefined) {
      total = prices[course][contractType];
    } else {
      output.innerHTML = '';
      return;
    }
  }
  const calcDateObj = new Date(dateVal);
  const month = calcDateObj.getMonth();
  const year = calcDateObj.getFullYear();
  const acadStartYear = month >= 8 ? year : year - 1;
  const year1 = acadStartYear;
  const year2 = acadStartYear + 1;
  const d1 = new Date(`${year1}-10-31T23:59:59`);
  const d2 = new Date(`${year1}-12-31T23:59:59`);
  const d3 = new Date(`${year2}-02-28T23:59:59`);
  const d4 = new Date(`${year2}-04-30T23:59:59`);
  let requiredPercent = 0;
  if (calcDateObj > d4) {
    requiredPercent = 100;
  } else if (calcDateObj > d3) {
    requiredPercent = 75;
  } else if (calcDateObj > d2) {
    requiredPercent = 50;
  } else if (calcDateObj > d1) {
    requiredPercent = 25;
  }
  const requiredAmount = Math.ceil(total * requiredPercent / 100);
  if (paid >= requiredAmount) {
    output.innerHTML = `<span class="ok">${text[lang].statusOk}</span>`;
  } else {
    output.innerHTML = `<span class="late">${text[lang].statusLate} ${formatNumber(requiredAmount)}</span>`;
  }
}
</script>
</body>
</html>
